<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ULKA WAR ROOM - Command Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #0062ff; --dark: #0f172a; --success: #10b981; --bg: #f1f5f9; --purple: #a855f7; }
        body { font-family: 'Sarabun', sans-serif; background: var(--bg); color: var(--dark); margin: 0; overflow-x: hidden; }

        /* üîí Login Screen */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: var(--dark); z-index: 9999; display: flex; align-items: center; justify-content: center;
            padding: 20px;
        }
        .login-card { background: white; padding: 40px; border-radius: 30px; width: 100%; max-width: 400px; text-align: center; }

        /* üìä Dashboard Layout */
        .main-container { padding: 15px; max-width: 500px; margin: auto; display: none; min-height: 100vh; }
        .glass-card { background: #fff; border-radius: 28px; padding: 25px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); border: 1px solid #e2e8f0; margin-bottom: 15px; }
        .header-banner { background: var(--dark); color: #fff; padding: 15px 20px; border-radius: 20px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        
        .avatar { width: 45px; height: 45px; background: var(--primary); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.2rem; color: white; }

        .big-number { font-size: 3rem; font-weight: 800; letter-spacing: -2px; line-height: 1; margin: 10px 0; color: var(--dark); }
        .progress-custom { height: 18px; border-radius: 50px; background: #e2e8f0; margin: 20px 0; overflow: hidden; border: 1px solid #cbd5e1; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #0062ff, #00d4ff); width: 0%; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .stat-item { background: #fff; padding: 15px; border-radius: 20px; border: 1px solid #e2e8f0; text-align: center; transition: 0.3s; text-decoration: none; color: inherit; display: block; }
        .stat-item:active { transform: scale(0.95); }
        .stat-label { font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 4px; }
        .stat-val { font-size: 1.2rem; font-weight: 800; }

        .btn-cs { border-left: 5px solid var(--purple) !important; background: #faf5ff; }
        .sync-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 20px; font-weight: 800; margin-top: 10px; box-shadow: 0 8px 20px rgba(0, 98, 255, 0.25); display: flex; justify-content: center; align-items: center; gap: 10px; }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .spinning { animation: spin 0.8s linear infinite; }
        .loading-shimmer { opacity: 0.6; pointer-events: none; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card shadow-lg">
        <div class="mb-4"><i class="fas fa-id-card text-primary fa-3x"></i></div>
        <h3 class="fw-bold mb-1">ULKA WAR ROOM</h3>
        <p class="text-muted small mb-4">‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (user_db)</p>
        
        <div class="mb-3 text-start">
            <input type="text" id="pass-input" class="form-control form-control-lg border-0 bg-light text-center" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
        </div>
        <button onclick="checkLogin()" id="login-btn" class="btn btn-primary w-100 btn-lg rounded-pill fw-bold py-3">LOGIN</button>
        <p id="login-err" class="text-danger mt-3 small fw-bold" style="display:none;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö!</p>
    </div>
</div>

<div class="main-container" id="dashboard-content">
    <div class="header-banner shadow-sm">
        <div>
            <h6 class="fw-bold mb-0 text-white" id="u-name">Loading...</h6>
            <small id="u-dept" class="opacity-75" style="font-size: 0.7rem;"></small>
        </div>
        <div class="avatar" id="u-initial">U</div>
    </div>

    <div class="glass-card text-center" id="main-display">
        <span class="badge bg-primary-subtle text-primary rounded-pill mb-2 px-3">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå</span>
        <div class="big-number" id="actual-sales">‡∏ø0.00</div>
        <div class="progress-custom"><div id="bar-fill" class="bar-fill"></div></div>
        <div class="d-flex justify-content-between align-items-center px-1">
            <span class="h4 fw-bold text-primary mb-0" id="pct-val">0%</span>
            <small class="text-muted fw-bold small">‡πÄ‡∏õ‡πâ‡∏≤ 7,000,000</small>
        </div>
    </div>

    <div class="stat-grid">
        <div class="stat-item shadow-sm border-start border-danger border-4">
            <div class="stat-label text-danger">‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å</div>
            <div class="stat-val text-danger" id="gap-val">‡∏ø0</div>
        </div>
        <div class="stat-item shadow-sm border-start border-info border-4">
            <div class="stat-label text-info">‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥/‡∏ß‡∏±‡∏ô</div>
            <div class="stat-val text-info" id="daily-val">‡∏ø0</div>
        </div>
        
        <a href="https://blanister.github.io/csspace/" class="stat-item shadow-sm btn-cs">
            <div class="stat-label" style="color: var(--purple);">CS SPACE</div>
            <div class="stat-val" style="color: var(--purple);"><i class="fas fa-external-link-alt small me-1"></i> ‡∏Ñ‡∏•‡∏¥‡∏Å</div>
        </a>

        <div class="stat-item shadow-sm border-start border-success border-4">
            <div class="stat-label text-success">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div>
            <div class="stat-val text-success" id="profit-val">‡∏ø0</div>
        </div>
    </div>

    <button class="sync-btn" onclick="fetchData()">
        <i id="sync-icon" class="fas fa-sync-alt"></i>
        <span>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
    </button>
    
    <div class="text-center mt-4">
        <small class="text-muted d-block mb-2">‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="sync-time">-</span></small>
        <button class="btn btn-sm btn-outline-secondary rounded-pill px-3" onclick="logout()" style="font-size: 0.7rem;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
</div>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxjuIt0g4Hlsh6q-pMIY04eohi94lRkgSoka5k7Ye2RjQNeabgHn5g99_cpCZSxQHjC-Q/exec";

    // üîë ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ Login ‡∏à‡∏≤‡∏Å user_db ‡πÉ‡∏ô Google Sheets
    async function checkLogin() {
        const userId = document.getElementById('pass-input').value;
        const btn = document.getElementById('login-btn');
        const err = document.getElementById('login-err');
        
        if(!userId) return;
        
        btn.disabled = true;
        btn.innerText = "CHECKING...";
        err.style.display = 'none';

        try {
            // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏µ‡πà Apps Script ‡πÇ‡∏î‡∏¢‡∏£‡∏∞‡∏ö‡∏∏ action ‡πÅ‡∏•‡∏∞ id
            const response = await fetch(`${API_URL}?action=checkUser&id=${userId}`);
            const user = await response.json();

            if (user.found) {
                localStorage.setItem("ulka_session", JSON.stringify(user));
                initDashboard();
            } else {
                err.style.display = 'block';
            }
        } catch (e) {
            alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ!");
        } finally {
            btn.disabled = false;
            btn.innerText = "LOGIN";
        }
    }

    function initDashboard() {
        const session = localStorage.getItem("ulka_session");
        if (!session) return;

        const user = JSON.parse(session);
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('dashboard-content').style.display = 'block';
        
        // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏Å‡∏à‡∏≤‡∏Å user_db ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
        document.getElementById('u-name').innerText = user.name;
        document.getElementById('u-dept').innerText = user.dept;
        document.getElementById('u-initial').innerText = user.name.charAt(0);
        
        fetchData();
    }

    async function fetchData() {
        const icon = document.getElementById('sync-icon');
        icon.classList.add('spinning');

        try {
            const response = await fetch(`${API_URL}?action=getFebruaryWarRoom`);
            const data = await response.json();
            
            const TARGET = 7000000;
            const ACTUAL = data.actual;
            const pct = (ACTUAL / TARGET * 100).toFixed(1);
            const gap = TARGET - ACTUAL;

            document.getElementById('actual-sales').innerText = '‡∏ø' + ACTUAL.toLocaleString();
            document.getElementById('pct-val').innerText = pct + '%';
            document.getElementById('bar-fill').style.width = Math.min(pct, 100) + '%';
            document.getElementById('gap-val').innerText = '‡∏ø' + (gap > 0 ? (gap/1000000).toFixed(2) + 'M' : '0.00M');
            document.getElementById('daily-val').innerText = '‡∏ø' + (gap > 0 ? ((gap/data.daysLeft)/1000).toFixed(0) + 'K' : '0K');
            document.getElementById('profit-val').innerText = '‡∏ø' + (data.profit/1000000).toFixed(2) + 'M';
            
            document.getElementById('sync-time').innerText = new Date().toLocaleTimeString('th-TH');
        } catch (e) { console.error(e); } finally { icon.classList.remove('spinning'); }
    }

    function logout() { localStorage.removeItem("ulka_session"); location.reload(); }
    window.onload = () => { if(localStorage.getItem("ulka_session")) initDashboard(); };
</script>
</body>
</html>
