<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #007bff; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Sarabun', sans-serif; background: transparent; padding: 10px; color: #1e293b; overflow-x: hidden; }
        
        /* üì± Container Adjustments */
        .war-card { background: #fff; border-radius: 20px; padding: 20px; border: 1px solid #e2e8f0; height: 100%; box-shadow: 0 4px 6px rgba(0,0,0,0.05); transition: 0.3s; }
        
        /* üí∞ Stats */
        .stat-value { font-size: calc(1.8rem + 1vw); font-weight: 800; color: var(--primary); line-height: 1.2; word-break: break-all; }
        .progress { height: 12px; border-radius: 10px; margin: 12px 0; background: #f1f5f9; }
        
        /* üéØ Target Input */
        .input-group-target { background: #fff; padding: 10px 15px; border-radius: 50px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border: 1px solid #dee2e6; width: 100%; max-width: 350px; }
        .input-target { border: 2px solid var(--primary); border-radius: 8px; width: 120px; text-align: center; font-weight: 800; color: var(--primary); outline: none; }

        /* üìä Grid Adjustments */
        @media (max-width: 768px) {
            body { padding: 5px; }
            .war-card { padding: 15px; }
            .stat-value { font-size: 1.8rem; }
            .header-row { flex-direction: column; text-align: center; gap: 15px; }
            .target-box { justify-content: center !important; }
            .detail-row > div { border-bottom: 1px solid #eee; border-right: none !important; padding: 10px 0; }
            .detail-row > div:last-child { border-bottom: none; }
        }

        .badge-live { font-size: 0.65rem; background: #dcfce7; color: #166534; padding: 4px 8px; border-radius: 50px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <div class="container-fluid pb-5">
        <div class="d-flex justify-content-between align-items-center mb-3 header-row">
            <h5 class="fw-bold mb-0 text-dark"><i class="fas fa-rocket text-primary me-2"></i>Sales War Room</h5>
            <div class="d-flex align-items-center target-box">
                <div class="input-group-target d-flex align-items-center justify-content-center">
                    <span class="small fw-bold me-2">‡πÄ‡∏õ‡πâ‡∏≤:</span>
                    <input type="number" id="target-val" class="input-target" value="8000000" oninput="calculate()">
                    <span class="small fw-bold ms-2">‡∏ø</span>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-3">
            <div class="col-12 col-md-4">
                <div class="war-card border-top border-primary border-4">
                    <div class="d-flex justify-content-between">
                        <small class="text-muted fw-bold text-uppercase" style="font-size: 0.7rem;">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</small>
                        <span class="badge-live fw-bold">LIVE SYNC</span>
                    </div>
                    <div class="stat-value my-1" id="cur-sales">‡∏ø0</div>
                    <div class="progress">
                        <div id="prog-bar" class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: 0%"></div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small class="fw-bold text-primary" id="prog-pct">0%</small>
                        <small class="text-muted" style="font-size: 0.7rem;">‡∏Ç‡∏≠‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</small>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-4">
                <div class="war-card shadow-sm">
                    <small class="text-muted fw-bold text-uppercase" style="font-size: 0.7rem;">‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</small>
                    <div class="d-flex align-items-baseline gap-1">
                        <div class="stat-value text-dark" style="font-size: 2rem;">51</div>
                        <div class="fw-bold text-muted small">‡∏Ñ‡∏ô</div>
                    </div>
                    <div style="font-size: 0.6rem;" class="text-success fw-bold"><i class="fas fa-user-check"></i> Active Only</div>
                </div>
            </div>

            <div class="col-6 col-md-4">
                <div class="war-card bg-primary text-white border-0 shadow">
                    <small class="fw-bold opacity-75 text-uppercase" style="font-size: 0.7rem;">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏Ñ‡∏ô</small>
                    <div class="stat-value text-white mt-1" id="per-head" style="font-size: 1.5rem;">‡∏ø0</div>
                    <div style="font-size: 0.6rem;" class="opacity-75 mt-1">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ √∑ 51</div>
                </div>
            </div>
        </div>

        <div class="war-card bg-light border-0">
            <div class="row text-center detail-row">
                <div class="col-12 col-md-4 border-end">
                    <small class="text-muted fw-bold d-block" style="font-size: 0.75rem;">‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß</small>
                    <div class="fw-bold text-success h5 mb-0" id="done-sales">‡∏ø0</div>
                </div>
                <div class="col-12 col-md-4 border-end">
                    <small class="text-muted fw-bold d-block" style="font-size: 0.75rem;">‡∏¢‡∏±‡∏á‡∏Ç‡∏≤‡∏î‡∏≠‡∏µ‡∏Å</small>
                    <div class="fw-bold text-danger h5 mb-0" id="remaining">‡∏ø0</div>
                </div>
                <div class="col-12 col-md-4">
                    <small class="text-muted fw-bold d-block" style="font-size: 0.75rem;">‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô (18 ‡∏ß‡∏±‡∏ô)</small>
                    <div class="fw-bold text-dark h5 mb-0" id="avg-daily">‡∏ø0</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzcCjV81SFv-2Y8rdzb5qZ_u8iRIyHEtuJTruMyff9sVAVyfK_SWntv28vS7FKf77FFZQ/exec";
        let salesTotal = 0;
        const staffCount = 51;

        async function init() {
            try {
                const sResp = await fetch(`${SCRIPT_URL}?action=getSalesData`);
                const sData = await sResp.json();
                // ‡∏£‡∏ß‡∏°‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ
                salesTotal = sData.reduce((s, i) => s + (parseFloat(i.amount) || 0), 0);
                calculate();
            } catch (e) { 
                console.error("Fetch Error:", e);
                salesTotal = 1984469.24; // ‡∏¢‡∏≠‡∏î‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Å‡∏£‡∏ì‡∏µ Error
                calculate();
            }
        }

        function calculate() {
            const target = parseFloat(document.getElementById('target-val').value) || 1;
            const progress = (salesTotal / target * 100).toFixed(1);
            const remain = target - salesTotal;
            const daysLeft = 18;
            const avg = remain > 0 ? (remain / daysLeft) : 0;

            document.getElementById('cur-sales').innerText = '‡∏ø' + salesTotal.toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('done-sales').innerText = '‡∏ø' + salesTotal.toLocaleString();
            document.getElementById('per-head').innerText = '‡∏ø' + (salesTotal / staffCount).toLocaleString(undefined, {maximumFractionDigits: 0});
            document.getElementById('prog-pct').innerText = progress + '%';
            document.getElementById('prog-bar').style.width = Math.min(progress, 100) + '%';
            document.getElementById('remaining').innerText = '‡∏ø' + (remain > 0 ? remain : 0).toLocaleString();
            document.getElementById('avg-daily').innerText = '‡∏ø' + avg.toLocaleString(undefined, {maximumFractionDigits: 0});
        }
        
        init();
        setInterval(init, 300000); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
    </script>
</body>
</html>
