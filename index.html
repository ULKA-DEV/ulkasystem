<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ULKA SYSTEM v1.0.35 - Command Center</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #007bff; --bg-app: #f4f7f6; --text-main: #1e293b; --card-bg: #ffffff; --header-bg: #ffffff; }
        body.dark-mode { --bg-app: #0f172a; --text-main: #f1f5f9; --card-bg: #1e293b; --header-bg: #1e293b; }
        
        body { font-family: 'Sarabun', sans-serif; background: var(--bg-app); color: var(--text-main); height: 100vh; overflow: hidden; margin: 0; transition: 0.3s; padding-top: 110px; }
        
        /* üîí Login Screen */
        #login-screen { position: fixed; inset: 0; z-index: 9999; display: flex; justify-content: center; align-items: center; background: #0f172a; padding: 20px; }
        .login-box { background: #fff; padding: 30px; border-radius: 24px; width: 100%; max-width: 380px; text-align: center; }

        /* üîù Double-Layer Header (‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏£‡∏ß‡∏°‡∏õ‡∏∏‡πà‡∏°) */
        .top-nav-area { position: fixed; top: 0; left: 0; right: 0; z-index: 1100; background: var(--header-bg); border-bottom: 1px solid rgba(0,0,0,0.1); box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        
        /* Layer 1: Clock & Info */
        .header-top-bar { display: flex; justify-content: space-between; align-items: center; padding: 5px 15px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        
        /* Layer 2: Menu Buttons (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ) */
        .header-menu-bar { 
            display: flex; gap: 8px; overflow-x: auto; padding: 8px 15px; 
            scrollbar-width: none; -webkit-overflow-scrolling: touch;
        }
        .header-menu-bar::-webkit-scrollbar { display: none; }

        /* üîò ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏ô‡∏π‡πÅ‡∏ö‡∏ö‡∏ß‡∏á‡∏£‡∏µ (Pill) */
        .btn-dept { 
            flex: 0 0 auto; padding: 6px 16px; border-radius: 50px; border: 1px solid #ddd;
            background: var(--card-bg); color: var(--text-main); font-weight: 700; font-size: 13px;
            transition: 0.2s; white-space: nowrap; cursor: pointer;
        }
        .btn-dept.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* üì¶ Main Content Area */
        .main-container { height: calc(100vh - 120px); overflow-y: auto; padding: 15px; }
        .widget-card { background: var(--card-bg); border-radius: 20px; padding: 20px; border: 1px solid rgba(0,0,0,0.05); margin-bottom: 15px; }
        
        iframe { width: 100%; height: 100%; border-radius: 15px; background: #fff; border: 1px solid rgba(0,0,0,0.1); }
        .iframe-container { height: 100%; display: none; }
        .iframe-container.active { display: block; }

        /* ‚è∞ Clock Style */
        .clock-text { font-weight: 800; color: var(--primary); font-size: 1.1rem; }
        
        .btn-tool { background: rgba(0,0,0,0.05); border: none; width: 34px; height: 34px; border-radius: 10px; color: var(--text-main); }
        body.dark-mode .btn-tool { background: rgba(255,255,255,0.1); }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <i class="fas fa-cube fa-3x text-primary mb-3"></i>
            <h4 class="fw-bold">ULKA SYSTEM</h4>
            <input type="text" id="user" class="form-control mb-2" placeholder="User ID">
            <input type="password" id="pass" class="form-control mb-3" placeholder="Password">
            <button onclick="checkLogin()" class="btn btn-primary w-100 fw-bold">SIGN IN</button>
        </div>
    </div>

    <div id="main-app" class="d-none">
        <div class="top-nav-area">
            <div class="header-top-bar">
                <div class="d-flex align-items-center gap-2">
                    <i class="fas fa-cube text-primary"></i>
                    <span id="h-time" class="clock-text">00:00:00</span>
                </div>
                <div class="d-flex gap-2 align-items-center">
                    <div id="header-bday" class="small fw-bold text-danger d-none d-md-block"><i class="fas fa-birthday-cake"></i> <span id="h-bday-name"></span></div>
                    <button class="btn-tool" onclick="toggleDarkMode()"><i class="fas fa-moon"></i></button>
                    <button class="btn-tool text-danger" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </div>
            
            <div class="header-menu-bar" id="dept-menu">
                <div onclick="switchView('news', this)" class="btn-dept active" id="btn-news">üì¢ ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£</div>
                <div onclick="switchView('Executive/index', this)" class="btn-dept d-none" id="btn-exec">üëë ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</div>
                <div onclick="switchView('Marketing/index', this)" class="btn-dept d-none" id="btn-mkt">üìà ‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î</div>
                <div onclick="switchView('Customer Service/index', this)" class="btn-dept d-none" id="btn-csr">üéß CSR</div>
                <div onclick="switchView('Accounting/index', this)" class="btn-dept d-none" id="btn-acc">üí∞ ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</div>
                <div onclick="switchView('Technician/index', this)" class="btn-dept d-none" id="btn-tech">üõ†Ô∏è ‡∏ä‡πà‡∏≤‡∏á</div>
                <div onclick="switchView('Installation/index', this)" class="btn-dept d-none" id="btn-install">üöö ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</div>
            </div>
        </div>

        <main class="main-container">
            <div id="view-news">
                <div class="widget-card bg-primary text-white border-0 shadow-lg mb-4">
                    <div class="row align-items-center">
                        <div class="col-8">
                            <small class="opacity-75 fw-bold">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°‡∏™‡∏≤‡∏Ç‡∏≤‡∏´‡∏•‡∏±‡∏Å (MTD)</small>
                            <h2 class="fw-bold mb-0">‡∏ø 1,984,469.24</h2>
                        </div>
                        <div class="col-4 text-end opacity-50"><i class="fas fa-chart-line fa-3x"></i></div>
                    </div>
                </div>

                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <div class="widget-card shadow-sm">
                            <h6 class="fw-bold text-primary mb-3"><i class="fas fa-bullhorn me-2"></i>‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h6>
                            <div id="general-news-list" class="small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="widget-card shadow-sm">
                            <h6 class="fw-bold text-success mb-3"><i class="fas fa-birthday-cake me-2"></i>‡∏â‡∏•‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h6>
                            <div id="info-news-list" class="small">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-iframe" class="iframe-container h-100">
                <iframe id="main-iframe" src=""></iframe>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzcCjV81SFv-2Y8rdzb5qZ_u8iRIyHEtuJTruMyff9sVAVyfK_SWntv28vS7FKf77FFZQ/exec";
        let sessionData = null;

        async function checkLogin() {
            const u = document.getElementById('user').value, p = document.getElementById('pass').value;
            if(!u || !p) return;
            try {
                const resp = await fetch(`${SCRIPT_URL}?action=login&user=${u}&pass=${p}`);
                const res = await resp.json();
                if(res.success) { 
                    localStorage.setItem("user_session", JSON.stringify(res)); 
                    initApp(res); 
                } else { 
                    Swal.fire('Error', 'ID ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error'); 
                }
            } catch(e) { Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ', 'error'); }
        }

        function initApp(data) {
            sessionData = data;
            document.getElementById('login-screen').classList.add('d-none');
            document.getElementById('main-app').classList.remove('d-none');
            
            // ‡∏•‡πá‡∏≠‡∏Ñ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°
            checkPermissions(data.dept, data.role);
            
            startClock(); 
            loadNews();
        }

        function checkPermissions(dept, role) {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô Admin ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô ‡πÇ‡∏ä‡∏ß‡πå‡∏´‡∏°‡∏î
            if(role === 'admin' || dept.includes('‡∏õ‡∏£‡∏∞‡∏ò‡∏≤‡∏ô')) {
                document.querySelectorAll('.btn-dept').forEach(b => b.classList.remove('d-none'));
                return;
            }
            // ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏Å
            if(dept === '‡∏ù‡πà‡∏≤‡∏¢‡∏Å‡∏•‡∏¢‡∏∏‡∏ó‡∏ò‡πå‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î') document.getElementById('btn-mkt').classList.remove('d-none');
            if(dept === '‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢') document.getElementById('btn-csr').classList.remove('d-none');
            if(dept === '‡∏ù‡πà‡∏≤‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•') document.getElementById('btn-acc').classList.remove('d-none');
            if(dept === '‡πÅ‡∏ú‡∏ô‡∏Å‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á') document.getElementById('btn-tech').classList.remove('d-none');
        }

        function switchView(v, el) {
            document.querySelectorAll('.btn-dept').forEach(n => n.classList.remove('active'));
            el.classList.add('active');

            const isNews = v === 'news';
            document.getElementById('view-news').classList.toggle('d-none', !isNews);
            document.getElementById('view-iframe').classList.toggle('d-none', isNews);
            document.getElementById('view-iframe').classList.toggle('active', !isNews);
            
            if(!isNews) {
                document.getElementById('main-iframe').src = v + ".html";
            }
        }

        function startClock() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('h-time').innerText = now.toLocaleTimeString('th-TH');
            }, 1000);
        }

        async function loadNews() {
            try {
                const resp = await fetch(`${SCRIPT_URL}?action=getAnnounce`);
                const list = await resp.json();
                document.getElementById('general-news-list').innerHTML = list.filter(a => a.category === 'general').map(a => `<div class="mb-2 p-2 border-bottom"><b>${a.title}</b><br><small class="text-muted">${a.body}</small></div>`).join('') || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®';
            } catch(e) { console.log("News load fail"); }
        }

        function toggleDarkMode() { 
            document.body.classList.toggle('dark-mode'); 
            localStorage.setItem('dark_mode', document.body.classList.contains('dark-mode')); 
        }

        function logout() { localStorage.clear(); location.reload(); }

        window.onload = () => {
            if(localStorage.getItem('dark_mode') === 'true') document.body.classList.add('dark-mode');
            const savedSession = localStorage.getItem("user_session");
            if(savedSession) initApp(JSON.parse(savedSession));
        };
    </script>
</body>
</html>
