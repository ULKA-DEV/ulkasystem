<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ULKA BizPlan - Cloud Strategy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; background-color: #f1f5f9; overflow: hidden; }
        .horizontal-scroll-container { display: flex; overflow-x: auto; height: calc(100vh - 85px); padding: 20px; gap: 24px; align-items: flex-start; }
        .month-card { flex: 0 0 auto; width: 550px; background: white; border-radius: 24px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; display: flex; flex-direction: column; max-height: 100%; }
        .cell-input { width: 100%; text-align: right; padding: 6px; border: none; outline: none; background: transparent; font-family: 'Courier New', monospace; font-weight: bold; }
        .cell-input:focus { background: #eff6ff; color: #2563eb; }
        .toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 12px 24px; border-radius: 50px; opacity: 0; transition: 0.3s; z-index: 999; font-size: 14px; box-shadow: 0 10px 15px rgba(0,0,0,0.2); }
        .toast.show { opacity: 1; bottom: 50px; }
        ::-webkit-scrollbar { height: 8px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>

<div id="app" class="h-screen flex flex-col">
    <div class="bg-white border-b border-slate-200 p-4 flex justify-between items-center shadow-sm z-50">
        <div class="flex items-center gap-6 text-left">
            <div>
                <h1 class="font-extrabold text-slate-800 text-lg flex items-center gap-2">
                    <i class="fa-solid fa-chart-pie text-blue-600"></i> BizPlan Cloud
                </h1>
                <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Database: biz_plan (GID: 434918010)</p>
            </div>
            
            <div class="flex items-center gap-3 bg-blue-50 p-2 px-4 rounded-2xl border border-blue-100">
                <div class="flex flex-col">
                    <span class="text-[9px] font-bold text-blue-500 uppercase">‡πÄ‡∏õ‡πâ‡∏≤‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</span>
                    <div class="flex items-center gap-2">
                        <input type="number" v-model="yearlyGrowth" @input="calcMonthlyFromYearly" 
                               class="w-20 bg-white border-none rounded-lg px-2 py-1 text-sm font-black text-blue-700 shadow-sm focus:ring-2 focus:ring-blue-500" placeholder="0">
                        <span class="text-sm font-bold text-blue-600">%</span>
                    </div>
                </div>
                <i class="fa-solid fa-calculator text-blue-300"></i>
                <div class="flex flex-col">
                    <span class="text-[9px] font-bold text-slate-400 uppercase">‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
                    <span class="text-sm font-black text-green-600">{{ monthlyGrowthResult.toFixed(2) }}%</span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <button @click="loadFromCloud" class="px-4 py-2 bg-white text-slate-700 border border-slate-200 rounded-xl text-xs font-bold hover:bg-slate-50 transition-all shadow-sm">
                <i class="fa-solid fa-cloud-arrow-down me-2 text-emerald-500"></i> ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ä‡∏µ‡∏ó
            </button>
            <button @click="saveToCloud" class="px-4 py-2 bg-blue-600 text-white rounded-xl text-xs font-bold hover:bg-blue-700 transition-all shadow-lg shadow-blue-200">
                <i class="fa-solid fa-cloud-arrow-up me-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ä‡∏µ‡∏ó
            </button>
            <div class="h-8 w-px bg-slate-200 mx-2"></div>
            <button @click="addNextMonth" class="px-4 py-2 bg-slate-800 text-white rounded-xl text-xs font-bold hover:bg-slate-900 shadow-lg">
                <i class="fa-solid fa-plus me-2"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
            </button>
        </div>
    </div>

    <div class="horizontal-scroll-container" id="scrollContainer">
        <div v-for="(chunk, mIdx) in monthChunks" :key="mIdx" class="month-card">
            <div class="p-5 border-b bg-white rounded-t-3xl flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-blue-600 text-white rounded-xl flex items-center justify-center font-black shadow-lg shadow-blue-100">
                        {{ mIdx + 1 }}
                    </div>
                    <input v-model="months[mIdx].monthName" class="font-black text-lg bg-transparent border-none focus:ring-0 text-slate-700 w-40" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô...">
                </div>
                <div class="text-right">
                    <span class="text-[10px] block text-slate-400 font-black uppercase tracking-tighter">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏ß‡∏°</span>
                    <span class="font-black text-2xl text-blue-600">{{ formatNumber(getMonthlyTotal(chunk, 'sales')) }}</span>
                </div>
            </div>
            
            <div class="overflow-auto flex-1 px-2">
                <table class="w-full text-sm">
                    <thead class="text-[10px] text-slate-400 uppercase font-black">
                        <tr>
                            <th class="p-4 text-left">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th v-for="w in chunk" class="p-4 text-center">Week {{w.weekNum}}</th>
                        </tr>
                    </thead>
                    <tbody class="text-slate-600">
                        <tr class="bg-blue-50/50"><td class="p-3 font-black text-blue-600 text-xs rounded-l-xl">üîµ ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (INCOME)</td><td colspan="4" class="rounded-r-xl"></td></tr>
                        <tr class="border-b border-slate-50">
                            <td class="p-3 pl-6 text-xs font-bold">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ (Sales Projection)</td>
                            <td v-for="w in chunk" class="p-2"><input type="number" v-model.number="w.sales" class="cell-input text-blue-600"></td>
                        </tr>
                        <tr class="border-b border-slate-50">
                            <td class="p-3 pl-6 text-xs font-bold text-slate-400">‡∏ß‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏¥‡∏ô‡πÄ‡∏ä‡∏∑‡πà‡∏≠ / ‡∏≠‡∏∑‡πà‡∏ô‡πÜ</td>
                            <td v-for="w in chunk" class="p-2"><input type="number" v-model.number="w.loan" class="cell-input text-slate-400"></td>
                        </tr>
                        <tr class="bg-red-50/50"><td class="p-3 font-black text-red-600 text-xs rounded-l-xl">üî¥ ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (EXPENSE)</td><td colspan="4" class="rounded-r-xl"></td></tr>
                        <tr class="border-b border-slate-50">
                            <td class="p-3 pl-6 text-xs font-bold">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏á‡∏ó‡∏µ‡πà (Fix Cost)</td>
                            <td v-for="w in chunk" class="p-2"><input type="number" v-model.number="w.fixedCost" class="cell-input text-red-600"></td>
                        </tr>
                        <tr class="border-b border-slate-50">
                            <td class="p-3 pl-6 text-xs font-bold">‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏π‡πâ / ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢</td>
                            <td v-for="w in chunk" class="p-2"><input type="number" v-model.number="w.loanPayment" class="cell-input text-red-400"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="p-4 bg-slate-900 rounded-b-2xl">
                <div class="flex justify-between items-center text-white">
                    <div class="flex flex-col">
                        <span class="text-[9px] font-bold text-slate-400 uppercase">‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏™‡∏∞‡∏™‡∏°</span>
                        <span class="text-xl font-black text-emerald-400">{{ formatNumber(getCalculatedWeek(chunk[3]).accumulated) }}</span>
                    </div>
                    <div class="text-right">
                        <span class="text-[9px] font-bold text-slate-400 uppercase">Profit Margin</span>
                        <span class="text-xs block font-bold text-blue-300">{{ ((getMonthlyTotal(chunk, 'sales') - getMonthlyTotal(chunk, 'fixedCost')) / (getMonthlyTotal(chunk, 'sales') || 1) * 100).toFixed(1) }}%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <button @click="addNextMonth" class="flex-shrink-0 w-32 h-64 border-4 border-dashed border-slate-300 rounded-3xl flex flex-col items-center justify-center cursor-pointer hover:border-blue-500 hover:bg-white transition-all group">
            <div class="w-12 h-12 bg-slate-200 rounded-full flex items-center justify-center text-slate-400 group-hover:bg-blue-600 group-hover:text-white transition-all mb-4">
                <i class="fa-solid fa-plus text-xl"></i>
            </div>
            <span class="text-xs font-black text-slate-400 group-hover:text-blue-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</span>
        </button>
    </div>

    <div id="toast" class="toast"></div>
</div>

<script>
    const { createApp, ref, computed } = Vue;

    createApp({
        setup() {
            // üöÄ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö URL ‡∏Ç‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏û‡∏µ‡πà‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbypSTaEhrniHAZTMAJdSK1UYwU2qmiSAeJ3jWKD2w9D16VBS2XLs9wJMEONsrS0GKIxtw/exec";
            
            const weeks = ref([]);
            const months = ref([]);
            const yearlyGrowth = ref(0);
            const monthlyGrowthResult = ref(0);

            // üìà Logic ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏õ‡∏µ (Compound Interest Formula)
            const calcMonthlyFromYearly = () => {
                if (yearlyGrowth.value > 0) {
                    const r_year = yearlyGrowth.value / 100;
                    const r_month = (Math.pow(1 + r_year, 1/12) - 1) * 100;
                    monthlyGrowthResult.value = r_month;
                    showToast(`‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${r_month.toFixed(2)}%`);
                } else {
                    monthlyGrowthResult.value = 0;
                }
            };

            // ‚òÅÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö Cloud Sync (Google Sheets)
            const saveToCloud = async () => {
                showToast("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...");
                try {
                    const payload = { 
                        action: 'savePlan', 
                        data: { weeks: weeks.value, months: months.value, yearly: yearlyGrowth.value } 
                    };
                    const response = await fetch(SCRIPT_URL, { 
                        method: 'POST', 
                        body: JSON.stringify(payload) 
                    });
                    showToast("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡∏µ‡∏ó biz_plan");
                } catch (e) { showToast("‚ùå ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏•‡∏≤‡∏î: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏ô‡πá‡∏ï‡∏Ñ‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏û‡∏µ‡πà"); }
            };

            const loadFromCloud = async () => {
                showToast("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...");
                try {
                    const resp = await fetch(`${SCRIPT_URL}?action=loadPlan`);
                    const data = await resp.json();
                    if (data) {
                        weeks.value = data.weeks || [];
                        months.value = data.months || [];
                        yearlyGrowth.value = data.yearly || 0;
                        monthlyGrowthResult.value = yearlyGrowth.value > 0 ? (Math.pow(1 + (yearlyGrowth.value/100), 1/12) - 1) * 100 : 0;
                        showToast("üì• ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    }
                } catch (e) { showToast("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ"); }
            };

            // üõ†Ô∏è Management Functions
            const addNextMonth = () => {
                const mCount = months.value.length;
                months.value.push({ monthName: `Month ${mCount + 1}`, growthRate: 0 });
                for(let i=1; i<=4; i++) {
                    weeks.value.push({ weekNum: i, sales: 0, loan: 0, fixedCost: 0, loanPayment: 0, id: Math.random() });
                }
                setTimeout(() => {
                    const container = document.getElementById('scrollContainer');
                    container.scrollTo({ left: container.scrollWidth, behavior: 'smooth' });
                }, 100);
            };

            const monthChunks = computed(() => {
                const chunks = [];
                for (let i = 0; i < weeks.value.length; i += 4) chunks.push(weeks.value.slice(i, i + 4));
                return chunks;
            });

            const getCalculatedWeek = (w) => {
                let accumulated = 0;
                for (let week of weeks.value) {
                    const profit = (week.sales || 0) + (week.loan || 0) - (week.fixedCost || 0) - (week.loanPayment || 0);
                    accumulated += profit;
                    if (week.id === w.id) return { accumulated };
                }
                return { accumulated: 0 };
            };

            const getMonthlyTotal = (chunk, key) => chunk.reduce((sum, w) => sum + (w[key] || 0), 0);
            const formatNumber = (n) => n === 0 ? "‡∏ø0" : "‡∏ø" + n.toLocaleString();
            
            const showToast = (msg) => {
                const t = document.getElementById('toast');
                t.innerText = msg; t.classList.add('show');
                setTimeout(() => t.classList.remove('show'), 3000);
            };

            return { 
                weeks, months, monthChunks, yearlyGrowth, monthlyGrowthResult,
                calcMonthlyFromYearly, saveToCloud, loadFromCloud, addNextMonth, 
                getCalculatedWeek, getMonthlyTotal, formatNumber
            };
        }
    }).mount('#app');
</script>
</body>
</html>
